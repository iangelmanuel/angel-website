---
import { ClientRouter } from "astro:transitions"
import { siteInfo } from "@/const/site-info"

import Seo from "@/components/shared/Seo.astro"
import TopMenu from "@/components/shared/TopMenu.astro"
import MainContent from "@/components/shared/MainContent.astro"
import Footer from "@/components/shared/Footer.astro"

import type { LanguageData } from "@/types/language"

import "@/styles/global.css"

type Props = {
  t: LanguageData
  title: string
  description: string
  image?: string
}

const { t, title, description, image = siteInfo.seo.image } = Astro.props
const { currentLocale } = Astro
---

<script is:inline>
  ;(() => {
    const ls = typeof localStorage !== "undefined" ? localStorage : null
    const stored = ls ? ls.getItem("theme") : null
    const prefersDark =
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches
    const theme = stored || (prefersDark ? "dark" : "light")
    document.documentElement.classList.toggle("dark", theme === "dark")
  })()

  addEventListener("astro:after-swap", () => {
    const stored = localStorage.getItem("theme")
    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)"
    ).matches
    const theme = stored || (prefersDark ? "dark" : "light")
    document.documentElement.classList.toggle("dark", theme === "dark")
  })
</script>

<html
  lang={currentLocale}
  class="scroll-smooth"
>
  <head>
    <Seo
      title={title}
      description={description}
      image={image}
    />
    <ClientRouter />
  </head>

  <body class="selection:bg-blue-100 dark:selection:bg-blue-500/30">
    <TopMenu t={t} />

    <MainContent>
      <slot />
    </MainContent>

    <Footer t={t} />
  </body>
</html>
